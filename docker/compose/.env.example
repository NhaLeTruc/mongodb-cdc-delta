# MongoDB CDC to Delta Lake Pipeline - Environment Variables
# Copy this file to .env and customize the values for your environment

# ============================================
# MongoDB Configuration
# ============================================
MONGO_INITDB_ROOT_USERNAME=admin
MONGO_INITDB_ROOT_PASSWORD=admin123
MONGO_INITDB_DATABASE=cdcdb

# MongoDB Connection String (used by applications)
MONGODB_URI=mongodb://admin:admin123@mongodb:27017/cdcdb?authSource=admin&replicaSet=rs0

# ============================================
# Kafka Configuration
# ============================================
KAFKA_BOOTSTRAP_SERVERS=kafka:9092
KAFKA_TOPICS=mongodb.cdcdb.users,mongodb.cdcdb.orders
KAFKA_GROUP_ID=delta-writer-group

# Kafka Connect Settings
KAFKA_CONNECT_URL=http://kafka-connect:8083

# ============================================
# MinIO Configuration (S3-compatible storage)
# ============================================
MINIO_ROOT_USER=minioadmin
MINIO_ROOT_PASSWORD=minioadmin
MINIO_ENDPOINT=minio:9000
MINIO_BUCKET=lakehouse
MINIO_REGION=us-east-1
MINIO_SECURE=false

# MinIO Console (Web UI)
MINIO_CONSOLE_PORT=9001

# ============================================
# PostgreSQL Configuration (Metadata storage)
# ============================================
POSTGRES_USER=postgres
POSTGRES_PASSWORD=postgres
POSTGRES_DB=cdc_metadata
POSTGRES_HOST=postgres
POSTGRES_PORT=5432

# PostgreSQL Connection String
DATABASE_URL=postgresql://postgres:postgres@postgres:5432/cdc_metadata

# ============================================
# Delta Lake Configuration
# ============================================
DELTA_TABLE_BASE_PATH=s3://lakehouse/
DELTA_PARTITION_BY=_ingestion_date
DELTA_SCHEMA_CACHE_TTL=300

# ============================================
# Application Configuration
# ============================================
LOG_LEVEL=INFO
PYTHONUNBUFFERED=1
CHECKPOINT_DIR=/app/checkpoints
DLQ_TOPIC=cdc.dead_letter_queue

# ============================================
# Monitoring - Prometheus
# ============================================
PROMETHEUS_PORT=9090
PROMETHEUS_RETENTION_TIME=15d

# ============================================
# Monitoring - Grafana
# ============================================
GRAFANA_ADMIN_USER=admin
GRAFANA_ADMIN_PASSWORD=admin
GRAFANA_PORT=3000

# ============================================
# Distributed Tracing - Jaeger
# ============================================
JAEGER_AGENT_HOST=jaeger
JAEGER_AGENT_PORT=6831
JAEGER_UI_PORT=16686

# ============================================
# Error Handling Configuration
# ============================================
# Retry settings
MAX_RETRY_ATTEMPTS=3
RETRY_INITIAL_DELAY=0.5
RETRY_MAX_DELAY=30.0
RETRY_EXPONENTIAL_BASE=2.0

# Circuit breaker settings
CIRCUIT_BREAKER_FAILURE_THRESHOLD=5
CIRCUIT_BREAKER_TIMEOUT_SECONDS=60

# DLQ settings
DLQ_MAX_EVENTS_PER_MINUTE=10000
DLQ_FALLBACK_FILE=/app/dlq/fallback.jsonl

# Checkpoint settings
CHECKPOINT_COMMIT_INTERVAL_SECONDS=30

# ============================================
# Performance Tuning
# ============================================
# Kafka consumer settings
KAFKA_MAX_POLL_RECORDS=2000
KAFKA_SESSION_TIMEOUT_MS=45000
KAFKA_MAX_POLL_INTERVAL_MS=300000

# Batch processing settings
BATCH_SIZE=1000
BATCH_TIMEOUT_SECONDS=10

# MinIO upload settings
MINIO_MULTIPART_THRESHOLD=50MB
MINIO_MULTIPART_CHUNKSIZE=10MB

# ============================================
# Security Settings (Vault integration)
# ============================================
# Uncomment and configure if using HashiCorp Vault
# VAULT_ADDR=http://vault:8200
# VAULT_TOKEN=your-vault-token
# VAULT_ROLE_ID=your-role-id
# VAULT_SECRET_ID=your-secret-id

# ============================================
# Development/Testing Settings
# ============================================
# Set to 'development' or 'production'
ENVIRONMENT=development

# Enable debug mode (more verbose logging)
DEBUG=false

# Enable test data generation
ENABLE_TEST_DATA=false
TEST_DATA_SEED=42

# ============================================
# Docker Compose Settings
# ============================================
COMPOSE_PROJECT_NAME=mongodb-cdc-delta
COMPOSE_FILE=docker-compose.yml

# Resource limits (uncomment to enable)
# MONGODB_MEM_LIMIT=2g
# KAFKA_MEM_LIMIT=2g
# MINIO_MEM_LIMIT=1g
# POSTGRES_MEM_LIMIT=1g
